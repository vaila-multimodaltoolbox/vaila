# *vail√°* - Multimodal Toolbox

<p align="center">
  <img src="docs/images/vaila.png" alt="vail√° Logo" width="300"/>
</p>

<div align="center">
  <table>
    <tr>
      <th>Build Type</th>
      <th>Linux</th>
      <th>macOS</th>
      <th>Windows</th>
    </tr>
    <tr>
      <td><strong>Build Status</strong></td>
      <td><img src="https://img.shields.io/badge/Build-OK-brightgreen.svg" alt="Linux Build Status"></td>
      <td><img src="https://img.shields.io/badge/Build-OK-brightgreen.svg" alt="macOS Build Status"></td>
      <td><img src="https://img.shields.io/badge/Build-OK-brightgreen.svg" alt="Windows Build Status"></td>
    </tr>
  </table>
</div>

## Development of *vail√°*: Versatile Anarcho Integrated Liberation √Ånalysis in Multimodal Toolbox

## Introduction

The analysis of human movement is fundamental in both health and sports biomechanics, providing valuable insights into various aspects of physical performance, rehabilitation, and injury prevention. However, existing software often restricts user control and customization, acting as a "black box." With *vail√°*, users have the freedom to explore, customize, and create their own tools in a truly open-source and collaborative environment.

*vail√°* (Versatile Anarcho Integrated Liberation √Ånalysis) is an open-source multimodal toolbox that leverages data from multiple biomechanical systems to enhance human movement analysis. It integrates data from:

- **Retroreflective Motion Capture Systems** (e.g., Vicon, OptiTrack)
- **Inertial Measurement Unit (IMU) Systems** (e.g., Delsys, Noraxon)
- **Markerless Video Capture Technology** (e.g., OpenPose, MediaPipe)
- **Electromyography (EMG) Systems** (e.g., Delsys, Noraxon)
- **Force Plate Systems** (e.g., AMTI, Bertec)
- **GPS/GNSS Systems** (e.g., Garmin, Trimble)
- **MEG/EEG Systems** (for brain activity monitoring)
- **HR/ECG Systems** (for heart rate and electrical activity)

By integrating these diverse data sources, *vail√°* allows for comprehensive and accurate analysis of movement patterns, which is particularly beneficial for research and clinical applications.

## Key Features

- **Multimodal Data Analysis**: Analyze data from various sources such as IMU sensors, motion capture, markerless tracking, EMG, force plates, and GPS/GNSS systems.
- **File Management**: Tools for file operations, including rename, import, export, copy, move, remove, tree, find, and transfer.
- **Data Conversion**: Convert between C3D and CSV formats, and perform Direct Linear Transformation (DLT) methods for 2D and 3D reconstructions.
- **Video Processing**: Tools for converting videos to images, cutting videos, compressing (H.264 and HEVC H.265), synchronizing videos, and extracting pixel coordinates.
- **Data Visualization**: Display and plot 2D and 3D graphs; visualize CSV and C3D data.

---

## Description

This multimodal toolbox integrates data from various motion capture systems to facilitate advanced biomechanical analysis by combining multiple data sources. The primary objective is to improve understanding and evaluation of movement patterns across different contexts.

## *vail√°* Manifest

### English Version

Join us in the liberation from paid software with the "vail√° - Versatile Anarcho Integrated Liberation √Ånalysis in Multimodal Toolbox."

In front of you stands a versatile tool designed to challenge the boundaries of commercial systems. This software is a symbol of innovation and freedom, determined to eliminate barriers that protect the monopoly of expensive software, ensuring the dissemination of knowledge and accessibility.

With *vail√°*, you are invited to explore, experiment, and create without constraints. "vail√°" means "go there and do it!" ‚Äî encouraging you to harness its power to perform analysis with data from multiple systems.

### Vers√£o em Portugu√™s

Junte-se a n√≥s na liberta√ß√£o do software pago com o "vail√°: An√°lise Vers√°til da Liberta√ß√£o Anarquista Integrada na Caixa de Ferramentas Multimodal".

Diante de voc√™ est√° uma ferramenta vers√°til, projetada para desafiar as fronteiras dos sistemas comerciais. Este software √© um s√≠mbolo de inova√ß√£o e liberdade, determinado a eliminar as barreiras que protegem o monop√≥lio do software caro, garantindo a dissemina√ß√£o do conhecimento e a acessibilidade.

Com *vail√°*, voc√™ √© convidado a explorar, experimentar e criar sem restri√ß√µes. "vail√°" significa "vai l√° e fa√ßa!" ‚Äî encorajando voc√™ a aproveitar seu poder para realizar an√°lises com dados de m√∫ltiplos sistemas.

---

## Installation and Setup

### Prerequisites

- **Conda**: Ensure that [Anaconda](https://www.anaconda.com/download/success) is installed and accessible from the command line.

- **FFmpeg**: Required for video processing functionalities.

### Clone the Repository

```bash
git clone https://github.com/vaila-multimodaltoolbox/vaila
cd vaila
```

## Installation Instructions

---

## üü† For Linux:

1. **Make the installation script executable**:

```bash
sudo chmod +x install_vaila_linux.sh
```

2. **Run instalation script**:

```bash
./install_vaila_linux.sh
```

- The script will:

  - Set up the Conda environment using `./yaml_for_conda_env/vaila_linux.yaml`.
  - Copy program files to your home directory (~/vaila).
  - Install ffmpeg from system repositories.
  - Create a desktop entry for easy access.

3. **Notes**:

- Run the script as your regular user, not with sudo.
- Ensure that Conda is added to your PATH and accessible from the command line.

---

## ‚ö™ For macOS:

1. **Make the installation script executable**:

```bash
sudo chmod +x install_vaila_mac.sh
```

2. **Run the installation script**:

```bash
./install_vaila_mac.sh
```

- The script will:
  - Set up the Conda environment using `./yaml_for_conda_env/vaila_mac.yaml`.
  - Copy program files to your home directory (`~/vaila`).
  - Install ffmpeg using Homebrew.
  - Convert the .iconset folder to an .icns file for the app icon.
  - Create an application bundle (`vaila.app`) in your Applications folder.
  - Create a symbolic link in `/Applications` to the app in your home directory.

3. **Notes**:
  
- You may be prompted for your password when the script uses sudo to create the symbolic link.
- Ensure that Conda is added to your PATH and accessible from the command line.

---

## üîµ For Windows:

### 1. **Install Anaconda**
   - Download and install [Anaconda](https://www.anaconda.com/download/success).
   - Ensure that **Conda** is accessible from the terminal after installation.

### 2. **Download *vail√°***
   - Use **Git** to clone the repository:
     ```bash
     git clone https://github.com/vaila-multimodaltoolbox/vaila
     cd vaila
     ```
   - **Or download the zip file**:
     - Go to [*vail√°* GitHub Repository](https://github.com/vaila-multimodaltoolbox/vaila), download the `.zip` file, and extract the contents.

### 3. **Run the Installation Script**
   - Open **PowerShell** (with Anaconda initialized) or **Anaconda PowerShell Prompt**.
   - Navigate to the directory where *vail√°* was downloaded or extracted.
   - Execute the installation script:
     ```powershell
     powershell -ExecutionPolicy Bypass -File .\install_vaila_win.ps1
     ```

### 4. **Automatic Configuration**
   - The script will:
     - Set up the Conda environment using `yaml_for_conda_env/vaila_win.yaml`.
     - Copy *vail√°* program files to `C:\Users\<YourUser>\AppData\Local\vaila`.
     - Initialize Conda for PowerShell.
     - Install **FFmpeg**, **Windows Terminal**, and **PowerShell 7** using **winget** (if not already installed).
     - Add a profile for *vail√°* in **Windows Terminal** for quick access.
     - Create shortcuts for launching *vail√°*:
       - **Desktop shortcut**: A shortcut will be created on your desktop.
       - **Start Menu shortcut**: A shortcut will be added to the Windows Start Menu.

### ‚ö†Ô∏è **Important Notes**
   - Ensure **Conda** is accessible from the command line before running the script.
   - The installation script dynamically configures paths, so no manual adjustments are necessary for user-specific directories.

### 5. **Launching *vail√°***
   - After installation, you can launch *vail√°*:
     - Using the Desktop shortcut.
     - From the **Windows Start Menu** under *vail√°*.
     - From **Windows Terminal** via the pre-configured *vail√°* profile.
     - Manually, by running the following commands:
       ```powershell
       conda activate vaila
       python vaila.py
       ```
---

## Running the Application

### Running the Application After installation, you can launch *vail√°* from your applications menu or directly from the terminal, depending on your operating system.

- üü† Linux and ‚ö™ macOS: **From the Terminal bash or zsh**

1. Navigate to the `vaila` directory:
   
  ```bash
  cd ~/vaila
  ``` 

and run command:

  ```bash
  conda activate vaila
  python3 vaila.py
  ```

- üîµ Windows

- Click on the `vaila` icon in the Applications menu or use the shortcut in desktop or Windows Terminal.

- Windows: **From the Windows Terminal (Anaconda in path) or use Anaconda PowerShell**

1. Open Anaconda Prompt or Anaconda Powershell Prompt (Anaconda Powershell is recommended) and run command:

```Anaconda Powershell
conda activate vaila
python vaila.py
```

---

## If preferred, you can also run *vail√°* from the launch scripts.

### For üü† Linux and ‚ö™ macOS 

- From the Applications Menu:
  
  - Look for `vaila` in your applications menu and launch it by clicking on the icon. 

--- 

#### From the Terminal If you prefer to run *vail√°* from the terminal or if you encounter issues with the applications menu, you can use the provided launch scripts.

##### üü†Linux and ‚ö™ macOS

- **Make the script executable** (if you haven't already):

- üü† **Linux**
  
```bash
sudo chmod +x ~/vaila/linux_launch_vaila.sh
```

- **Run the script**:
  
```bash
~/vaila/linux_launch_vaila.sh 
```

- ‚ö™ **macOS**
  
```bash
sudo chmod +x ~/vaila/mac_launch_vaila.sh
```

- **Run the script**:
  
```bash
~/vaila/mac_launch_vaila.sh 
```

#### Notes for üü† Linux and ‚ö™ macOS 

- **Ensure Conda is in the Correct Location**:
  - The launch scripts assume that Conda is installed in `~/anaconda3`. 
  - If Conda is installed elsewhere, update the `source` command in the scripts to point to the correct location.

- **Verify Paths**:
  - Make sure that the path to `vaila.py` in the launch scripts matches where you have installed the program.
  - By default, the scripts assume that `vaila.py` is located in `~/vaila`.

- **Permissions**:
  - Ensure you have execute permissions for the launch scripts and read permissions for the program files. 

--- 

## Unistallation Instructions

## For Uninstallation on Linux

1. **Run the uninstall script**:

```bash
sudo chmod +x uninstall_vaila_linux.sh
./uninstall_vaila_linux.sh
```

- The script will:
  - Remove the `vaila` Conda environment.
  - Delete the `~/vaila` directory.
  - Remove the desktop entry.

2. **Notes**:

- Run the script `./uninstall_vaila_linux.sh` as your regular user, not with sudo.
- Ensure that Conda is added to your PATH and accessible from the command line.

## For Uninstallation on macOs

1. **Run the uninstall script**:

```bash
sudo chmod +x uninstall_vaila_mac.sh
./uninstall_vaila_mac.sh
```

- The script will:
  - Remove the `vaila` Conda environment.
  - Delete the `~/vaila` directory.
  - Remove `vaila.app` from /Applications.
  - Refresh the Launchpad to remove cached icons.

2. **Notes**:

- Run the script as your regular user, not with sudo.
- You will prompted for your password when the script uses `sudo` to remove the app from `/Applications`.

## For Uninstallation on Windows

1. **Run the uninstallation script as Administrator in Anaconda PowerShell Prompt**:

- PowerShell Script:
  ```powershell
  ExecutionPolicy Bypass -File .\uninstall_vaila_win.ps1
  .\uninstall_vaila_win.ps1
  ```

1. **Follow the Instructions Displayed by the Script**:

- The script will:
  - Remove the `vaila` Conda environment.
  - Delete the `C:\ProgramData\vaila` directory.
  - Remove the Windows Terminal profile (settings.json file).
  - Delete the desktop shortcut if it exists.

1. **Manual Removal of Windows Terminal Profile (if necessary)**:

- If the Windows Terminal profile is not removed automatically (e.g., when using the `uninstall_vaila_win.ps1` script), you may need to remove it manually:

```Anaconda PowerShell Prompt
conda remove -n vaila --all
```

Remove directory `vaila` inside `C:ProgramData\`.

---

## Project Structure

<p align="center">
  <img src="docs/images/vaila_start_gui.png" alt="vail√° Start GUI" width="600"/>
</p>


An overview of the project structure:

```bash
tree vaila

vaila
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ __pycache__
‚îú‚îÄ‚îÄ batchcut.py
‚îú‚îÄ‚îÄ cluster_analysis.py
‚îú‚îÄ‚îÄ cluster_analysis_cli.py
‚îú‚îÄ‚îÄ common_utils.py
‚îú‚îÄ‚îÄ compress_videos_h264.py
‚îú‚îÄ‚îÄ compress_videos_h265.py
‚îú‚îÄ‚îÄ compressvideo.py
‚îú‚îÄ‚îÄ cop_analysis.py
‚îú‚îÄ‚îÄ cop_calculate.py
‚îú‚îÄ‚îÄ data_processing.py
‚îú‚îÄ‚îÄ dialogsuser.py
‚îú‚îÄ‚îÄ dialogsuser_cluster.py
‚îú‚îÄ‚îÄ dlt2d.py
‚îú‚îÄ‚îÄ dlt3d.py
‚îú‚îÄ‚îÄ drawboxe.py
‚îú‚îÄ‚îÄ ellipse.py
‚îú‚îÄ‚îÄ emg_labiocom.py
‚îú‚îÄ‚îÄ extractpng.py
‚îú‚îÄ‚îÄ filemanager.py
‚îú‚îÄ‚îÄ filter_utils.py
‚îú‚îÄ‚îÄ filtering.py
‚îú‚îÄ‚îÄ fixnoise.py
‚îú‚îÄ‚îÄ fonts
‚îú‚îÄ‚îÄ force_cmj.py
‚îú‚îÄ‚îÄ force_cube_fig.py
‚îú‚îÄ‚îÄ forceplate_analysis.py
‚îú‚îÄ‚îÄ getpixelvideo.py
‚îú‚îÄ‚îÄ gnss_analysis.py
‚îú‚îÄ‚îÄ images
‚îú‚îÄ‚îÄ imu_analysis.py
‚îú‚îÄ‚îÄ listjointsnames.py
‚îú‚îÄ‚îÄ maintools.py
‚îú‚îÄ‚îÄ markerless_2D_analysis.py
‚îú‚îÄ‚îÄ markerless_3D_analysis.py
‚îú‚îÄ‚îÄ mergestack.py
‚îú‚îÄ‚îÄ mocap_analysis.py
‚îú‚îÄ‚îÄ modifylabref.py
‚îú‚îÄ‚îÄ modifylabref_cli.py
‚îú‚îÄ‚îÄ numberframes.py
‚îú‚îÄ‚îÄ plotting.py
‚îú‚îÄ‚îÄ readc3d_export.py
‚îú‚îÄ‚îÄ readcsv.py
‚îú‚îÄ‚îÄ readcsv_export.py
‚îú‚îÄ‚îÄ rearrange_data.py
‚îú‚îÄ‚îÄ rearrange_data_dask.py
‚îú‚îÄ‚îÄ rec2d.py
‚îú‚îÄ‚îÄ rec2d_one_dlt2d.py
‚îú‚îÄ‚îÄ rotation.py
‚îú‚îÄ‚îÄ run_vector_coding.py
‚îú‚îÄ‚îÄ run_vector_coding_GUI.py
‚îú‚îÄ‚îÄ showc3d.py
‚îú‚îÄ‚îÄ showc3d_nodash.py
‚îú‚îÄ‚îÄ spectral_features.py
‚îú‚îÄ‚îÄ stabilogram_analysis.py
‚îú‚îÄ‚îÄ standardize_header.py
‚îú‚îÄ‚îÄ sync_flash.py
‚îú‚îÄ‚îÄ syncvid.py
‚îú‚îÄ‚îÄ utils.py
‚îú‚îÄ‚îÄ vaila_manifest.py
‚îú‚îÄ‚îÄ vaila_upscaler.py
‚îú‚îÄ‚îÄ vailaplot2d.py
‚îú‚îÄ‚îÄ vailaplot3d.py
‚îú‚îÄ‚îÄ vector_coding.py
‚îú‚îÄ‚îÄ videoprocessor.py
‚îî‚îÄ‚îÄ videoprocessor2.py
```

## Citing *vail√°*

If you use *vail√°* in your research or project, please consider citing our work:

```bibtex
@misc{vaila2024,
  title={vail√° - Versatile Anarcho Integrated Liberation √Ånalysis in Multimodal Toolbox},
  author={Paulo Roberto Pereira Santiago and Guilherme Manna Cesar and Ligia Yumi Mochida and Juan Aceros and others},
  year={2024},
  eprint={2410.07238},
  archivePrefix={arXiv},
  primaryClass={cs.HC},
  url={https://arxiv.org/abs/2410.07238}
}
```

## You can also refer to the tool's GitHub repository for more details and updates:

- [*vail√°* on arXiv](https://arxiv.org/abs/2410.07238)
- [*vail√°* GitHub Repository](https://github.com/vaila-multimodaltoolbox/vaila)

## Authors

- **Paulo Roberto Pereira Santiago** [ORCID: 0000-0002-9460-8847](https://orcid.org/0000-0002-9460-8847)  
  Biomechanics and Motor Control Lab, School of Physical Education and Sport of Ribeir√£o Preto, University of S√£o Paulo, Brazil  
  Graduate Program in Rehabilitation and Functional Performance, Ribeir√£o Preto Medical School, University of S√£o Paulo, Brazil  

- **Abel Gon√ßalves Chinaglia** [ORCID: 0000-0002-6955-7187](https://orcid.org/0000-0002-6955-7187)  
  Graduate Program in Rehabilitation and Functional Performance, Ribeir√£o Preto Medical School, University of S√£o Paulo, Brazil  

- **Kira Flanagan** [ORCID: 0000-0003-0317-6346](https://orcid.org/0000-0003-0317-6346)  
  College of Computing, Engineering and Construction, University of North Florida, USA  

- **Bruno Luiz de Souza Bedo** [ORCID: 0000-0003-3821-2327](https://orcid.org/0000-0003-3821-2327)  
  Laboratory of Technology and Sports Performance Analysis, School of Physical Education and Sport, University of S√£o Paulo, Brazil  

- **Ligia Yumi Mochida** [ORCID: 0009-0005-7266-3799](https://orcid.org/0009-0005-7266-3799)  
  Laboratory of Applied Biomechanics and Engineering, Brooks College of Health, University of North Florida, USA  
  Department of Physical Therapy, Brooks College of Health, University of North Florida, USA  

- **Juan Aceros** [ORCID: 0000-0001-6381-7032](https://orcid.org/0000-0001-6381-7032)  
  Laboratory of Applied Biomechanics and Engineering, Brooks College of Health, University of North Florida, USA  
  College of Computing, Engineering and Construction, University of North Florida, USA

- **Aline Bononi** [ORCID: 0000-0001-8169-0864](https://orcid.org/0000-0001-8169-0864)
  Municipal Pharmacy of Ribeir√£o Preto - Brazil

- **Guilherme Manna Cesar** [ORCID: 0000-0002-5596-9439](https://orcid.org/0000-0002-5596-9439)  
  Laboratory of Applied Biomechanics and Engineering, Brooks College of Health, University of North Florida, USA  
  Department of Physical Therapy, Broo~/vaila/linux_launch_vaila.sh ks College of Health, University of North Florida, USA  

## Contribution

We encourage creativity and innovation to enhance and expand the functionality of this toolbox. You can make a difference by contributing to the project! To get involved, feel free to fork the repository, experiment with new ideas, and create a branch for your changes. When you're ready, submit a pull request so we can review and potentially integrate your contributions.

Don't hesitate to learn, explore, and experiment. Be bold, and don't be afraid to make mistakes‚Äîevery attempt is a step towards improvement!

## License

This project is primarily licensed under the GNU Lesser General Public License v3.0. Please cite our work if you use the code or data. Let's collaborate and push the boundaries together!
