<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MP Angles - MediaPipe Angle Calculation</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; max-width: 1200px; }
    h1, h2, h3 { color: #2c3e50; }
    h1 { border-bottom: 3px solid #3498db; padding-bottom: 10px; }
    h2 { border-bottom: 2px solid #ecf0f1; padding-bottom: 5px; margin-top: 30px; }
    h3 { color: #34495e; margin-top: 20px; }
    pre { background-color: #f4f4f4; padding: 15px; overflow: auto; border-left: 4px solid #3498db; }
    code { background-color: #f4f4f4; padding: 3px 6px; border-radius: 3px; }
    table { border-collapse: collapse; width: 100%; margin: 20px 0; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    th { background-color: #3498db; color: white; }
    tr:nth-child(even) { background-color: #f2f2f2; }
    .info-box { background-color: #e8f4f8; border-left: 4px solid #3498db; padding: 15px; margin: 20px 0; }
    .warning-box { background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; }
    ul, ol { margin: 10px 0; padding-left: 30px; }
    li { margin: 5px 0; }
  </style>
</head>
<body>
  <h1>MP Angles - MediaPipe Angle Calculation</h1>

  <div class="info-box">
    <strong>Module Information:</strong><br>
    Category: Utils | File: vaila/mpangles.py | Version: 0.0.2<br>
    Author: Paulo R. P. Santiago | License: AGPL v3.0
  </div>

  <h2>Description</h2>
  <p>
    The <strong>MP Angles</strong> module calculates absolute and relative joint angles from landmark coordinates obtained from MediaPipe pose estimation. This tool processes CSV files containing MediaPipe landmark data (33 landmarks) and generates comprehensive angle calculations for biomechanical analysis.
  </p>

  <h3>Key Features</h3>
  <ul>
    <li><strong>Absolute Angles:</strong> Calculates angles between body segments and the horizontal axis</li>
    <li><strong>Relative Angles:</strong> Computes joint angles between connected body segments</li>
    <li><strong>Video Visualization:</strong> Creates annotated videos with skeleton overlay and real-time angle display</li>
  </ul>

  <h2>Supported Angles</h2>
  
  <h3>Relative Angles (Joint Angles)</h3>
  <ul>
    <li>Neck Angle</li>
    <li>Trunk Angle</li>
    <li>Shoulder Angle (left and right)</li>
    <li>Elbow Angle (left and right)</li>
    <li>Wrist Angle (left and right)</li>
    <li>Hip Angle (left and right)</li>
    <li>Knee Angle (left and right)</li>
    <li>Ankle Angle (left and right)</li>
  </ul>

  <h3>Absolute Angles (Segment Angles)</h3>
  <ul>
    <li>Upper arm, Forearm, Hand (left and right)</li>
    <li>Thigh, Shank, Foot (left and right)</li>
    <li>Trunk and Neck</li>
  </ul>

  <h2>Usage</h2>

  <h3>Method 1: GUI Mode (Recommended)</h3>
  <ol>
    <li>Click the <strong>"MP Angles"</strong> button (B4_r4_c4) in the vailá GUI</li>
    <li>Select angle format: 0-360° or -180° to +180°</li>
    <li>Choose processing type:
      <ul>
        <li><strong>Yes:</strong> Process video with visualization (requires CSV + video)</li>
        <li><strong>No:</strong> Process CSV files only (faster, batch processing)</li>
      </ul>
    </li>
    <li>Select input files/directory as prompted</li>
    <li>Wait for processing to complete</li>
  </ol>

  <h3>Method 2: Command Line</h3>
  <pre><code>conda activate vaila
python -m vaila.mpangles</code></pre>

  <h2>Input Requirements</h2>

  <h3>CSV File Format</h3>
  <p>Input CSV files must contain MediaPipe landmark coordinates:</p>
  <ul>
    <li><strong>First column:</strong> Frame index (0, 1, 2, ...)</li>
    <li><strong>Subsequent columns:</strong> 33 landmarks × 2 coordinates = 66 columns</li>
    <li><strong>Format:</strong> p0_x, p0_y, p1_x, p1_y, ..., p32_x, p32_y</li>
    <li><strong>Total:</strong> 67 columns (1 frame + 66 coordinates)</li>
  </ul>

  <div class="info-box">
    <strong>Note:</strong> CSV files from Markerless 2D Analysis are directly compatible with MP Angles.
  </div>

  <h2>Output Files</h2>

  <h3>CSV Processing Mode</h3>
  <p>Generates two CSV files per input file:</p>
  <ol>
    <li><strong>processed_{filename}_rel.csv</strong> - Relative angles (joint angles)</li>
    <li><strong>processed_{filename}_abs.csv</strong> - Absolute angles (segment angles)</li>
  </ol>

  <h3>Video Processing Mode</h3>
  <p>Generates:</p>
  <ol>
    <li><strong>angles_{videoname}.mp4</strong> - Annotated video with skeleton and angles</li>
    <li><strong>{videoname}_rel.csv</strong> - Relative angles CSV</li>
    <li><strong>{videoname}_abs.csv</strong> - Absolute angles CSV</li>
  </ol>

  <h2>Configuration</h2>

  <h3>Angle Format</h3>
  <ul>
    <li><strong>0-360° Format:</strong> Absolute angles from 0° to 360° (no negative values)</li>
    <li><strong>-180° to +180° Format:</strong> Absolute angles from -180° to +180° (biomechanical standard)</li>
  </ul>

  <h2>Troubleshooting</h2>

  <h3>Common Issues</h3>
  <table>
    <tr>
      <th>Issue</th>
      <th>Solution</th>
    </tr>
    <tr>
      <td>No CSV files found</td>
      <td>Ensure CSV files are in the selected directory with .csv extension</td>
    </tr>
    <tr>
      <td>Error reading CSV</td>
      <td>Verify CSV format matches MediaPipe 33-landmark structure</td>
    </tr>
    <tr>
      <td>Video/CSV mismatch</td>
      <td>Ensure video and CSV have the same number of frames</td>
    </tr>
    <tr>
      <td>Permission denied</td>
      <td>Check write permissions and disk space</td>
    </tr>
  </table>

  <h2>Requirements</h2>
  <ul>
    <li>Python 3.12.12+</li>
    <li>pandas, numpy, opencv-python, tkinter, rich</li>
    <li>FFmpeg (for video processing)</li>
  </ul>

  <h2>Integration</h2>
  <p>
    <strong>Input from:</strong> Markerless 2D Analysis, Markerless 3D Analysis, any MediaPipe-based analysis<br>
    <strong>Output to:</strong> Data analysis tools, visualization software, statistical analysis
  </p>

  <h2>Related Documentation</h2>
  <ul>
    <li><a href="../../../docs/vaila_buttons/mp-angles-calculation.html">MP Angles Button Documentation</a></li>
    <li><a href="../analysis/markerless_2d_analysis.html">Markerless 2D Analysis Help</a></li>
    <li><a href="../../../docs/index.html">vailá Main Documentation</a></li>
  </ul>

  <hr>
  <p><small>Last Updated: November 2025 | Part of vailá - Multimodal Toolbox</small></p>
</body>
</html>
