<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vail√° - cutvideo.py</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 36px; line-height: 1.6; background: #f5f5f5; }
        .container { max-width: 960px; margin: 0 auto; background: #fff; padding: 28px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 28px; border-bottom: 2px solid #ecf0f1; padding-bottom: 6px; }
        h3 { color: #2c3e50; margin-top: 16px; }
        ul { padding-left: 22px; }
        li { margin: 6px 0; }
        .module-info, .card { background: #f7f9fb; padding: 14px 16px; border-radius: 6px; border-left: 4px solid #3498db; margin: 14px 0; }
        .footer { margin-top: 34px; padding-top: 18px; border-top: 1px solid #dee2e6; color: #6c757d; font-size: 0.95em; }
        code { background: #eef2f5; padding: 2px 5px; border-radius: 4px; }
    </style>
</head>
<body>
<div class="container">
    <h1>cutvideo.py</h1>

    <div class="module-info">
        <h3>üìã Module Information</h3>
        <p><strong>Category:</strong> Tools</p>
        <p><strong>File:</strong> vaila/cutvideo.py</p>
        <p><strong>Version:</strong> 0.1.0</p>
        <p><strong>Author:</strong> Paulo Roberto Pereira Santiago</p>
        <p><strong>Email:</strong> paulosantiago@usp.br</p>
        <p><strong>GitHub:</strong> <a href="https://github.com/vaila-multimodaltoolbox/vaila">vaila-multimodaltoolbox/vaila</a></p>
        <p><strong>GUI Interface:</strong> ‚úÖ Yes</p>
        <p><strong>License:</strong> AGPL v3.0</p>
    </div>

    <div class="card">
        <h2>üìñ Description</h2>
        <p>Interactive video cutting with frame-accurate navigation, TOML-based cut storage, batch/sync workflows, and high-resolution timestamps (.6f) suitable for biomechanics.</p>
    </div>

    <div class="card">
        <h2>Key Updates</h2>
        <ul>
            <li><strong>TOML cuts</strong>: Saves/loads <code>{basename}_cuts.toml</code> with 1-based frames, .6f precision, and <code>frame_count = end - start + 1</code> (duration = frame_count / fps). Paths stored as POSIX to avoid escaping.</li>
            <li><strong>Marker navigation</strong>: PageUp/PageDown cycle through every start/end marker; Home/End jump to current/last cut bounds.</li>
            <li><strong>Manual FPS</strong>: Hotkey <code>I</code>/<code>P</code> overrides FPS via Tk dialog and refreshes the UI.</li>
            <li><strong>Scrollable help</strong>: Help overlay scrolls with mouse wheel or arrow keys.</li>
            <li><strong>Output naming</strong>: Single ‚Üí <code>{video}_vailacut_{timestamp}</code>; batch ‚Üí <code>vailacut_{prefix}{source}_batch_{timestamp}</code>; sync batch ‚Üí <code>vailacut_sync_{video}_{timestamp}</code>; files use 1-based frame ranges.</li>
            <li><strong>Time display</strong>: Caption shows filename + FPS; slider shows frame and time (<code>Frame: X/Y (t/T)</code>).</li>
        </ul>
    </div>

    <div class="card">
        <h2>üîß Main Functions (high level)</h2>
        <ul>
            <li><code>play_video_with_cuts()</code> ‚Äî main UI/player and cut workflow.</li>
            <li><code>save_cuts_to_toml()</code> ‚Äî writes TOML (1-based frames, .6f times, frame-count duration).</li>
            <li><code>load_cuts_from_toml()</code> / <code>load_cuts_from_toml_file()</code> ‚Äî reads TOML; legacy <code>.txt</code> as fallback.</li>
            <li><code>cut_video_with_ffmpeg()</code> (precise) and <code>cut_video_with_opencv()</code> (fallback).</li>
            <li><code>batch_process_videos()</code> and <code>batch_process_sync_videos()</code> ‚Äî reuse marked cuts across files.</li>
            <li><code>get_precise_video_metadata()</code> ‚Äî ffprobe-first, OpenCV fallback.</li>
            <li><code>run_cutvideo()</code> ‚Äî entry point.</li>
        </ul>
    </div>

    <div class="card">
        <h2>üéÆ Controls (UI)</h2>
        <ul>
            <li><strong>Playback/Navigation:</strong> Space (play/pause), ‚Üí/‚Üê (frame step), ‚Üë/‚Üì (¬±60 frames), slider click (jump).</li>
            <li><strong>Markers/Cuts:</strong> S (start), E (end), R (reset start), D or Delete (remove last cut), L (list cuts).</li>
            <li><strong>Marker navigation:</strong> PageUp/PageDown (prev/next marker), Home/End (start/end of current or first/last cut).</li>
            <li><strong>Jump inputs:</strong> G (frame), T (time), I or P (manual FPS input).</li>
            <li><strong>File ops:</strong> F (load cuts TOML or sync TXT), ESC (save TOML, optionally render cuts; batch prompt).</li>
            <li><strong>Help:</strong> H or click ‚ÄúHelp‚Äù (scrollable overlay).</li>
        </ul>
    </div>

    <div class="card">
        <h2>üìÅ Formats</h2>
        <ul>
            <li><strong>Input videos:</strong> .mp4, .avi, .mov, .mkv (ffmpeg/OpenCV-readable).</li>
            <li><strong>Cuts file:</strong> <code>{basename}_cuts.toml</code>
                <ul>
                    <li>Metadata: <code>video_name</code>, <code>fps</code> (.6f), <code>created</code>, <code>source_file</code> (POSIX path).</li>
                    <li>Per cut (1-based): <code>index</code>, <code>start_frame</code>, <code>end_frame</code>, <code>frame_count</code>, <code>start_time</code>, <code>end_time</code>, <code>duration</code> (= frame_count / fps).</li>
                </ul>
            </li>
            <li><strong>Sync TXT:</strong> <code>video_file new_name initial_frame final_frame</code> (integers).</li>
            <li><strong>Outputs:</strong>
                <ul>
                    <li>Folder (single): <code>{video}_vailacut_{timestamp}</code> (or <code>{video}_sync_vailacut_{timestamp}</code> when using sync).</li>
                    <li>Folder (batch): <code>vailacut_{prefix}{source}_batch_{timestamp}</code>.</li>
                    <li>Files: <code>{video}_frame_{start}_to_{end}.mp4</code> (1-based in names).</li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="card">
        <h2>üî¨ Precision Notes</h2>
        <ul>
            <li>FPS stored/written with .6f; duration uses frame counts to include the last frame.</li>
            <li>UI displays frames as 1-based; internal math is 0-based.</li>
            <li>PageUp/PageDown iterate over every start and end marker (sorted, deduped).</li>
        </ul>
    </div>

    <div class="card">
        <h2>üêõ Troubleshooting Quick Hits</h2>
        <ul>
            <li><strong>No ffmpeg:</strong> Falls back to OpenCV; install ffmpeg for frame-accurate cuts.</li>
            <li><strong>Windows paths in TOML:</strong> Stored with <code>/</code> to avoid escape issues.</li>
            <li><strong>Cannot load cuts:</strong> Ensure file is <code>.toml</code> with <code>[[cuts]]</code>; legacy <code>.txt</code> still loads but is deprecated.</li>
        </ul>
    </div>

    <div class="footer">
        <p>üìÖ Last Updated: January 2026</p>
        <p>üîó Part of vail√° - Multimodal Toolbox | <a href="https://github.com/vaila-multimodaltoolbox/vaila">GitHub</a></p>
    </div>
</div>
</body>
</html>
