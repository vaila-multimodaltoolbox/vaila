<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DLT3D and 3D Reconstruction - vailá</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        h3 {
            color: #2c3e50;
            margin-top: 25px;
        }
        .module-section {
            background-color: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
        }
        .code-block {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 15px 0;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .step {
            background-color: #e8f5e8;
            border: 1px solid #c3e6c3;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        ul {
            padding-left: 20px;
        }
        li {
            margin: 8px 0;
        }
        .file-format {
            background-color: #f1f2f6;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>DLT3D and 3D Reconstruction - vailá</h1>
        
        <div class="info">
            <strong>Overview:</strong> This guide explains how to use vailá's DLT3D calibration and 3D reconstruction modules for three-dimensional motion analysis.
        </div>

        <h2>Available Modules</h2>
        
        <div class="module-section">
            <h3>1. dlt3d.py - DLT3D Calibration</h3>
            <p><strong>Function:</strong> Calculates DLT3D parameters (11 parameters) for transforming pixel coordinates to real 3D coordinates.</p>
            
            <h4>How to use:</h4>
            <div class="step">
                <strong>Step 1:</strong> Run the dlt3d.py script
            </div>
            <div class="step">
                <strong>Step 2:</strong> Select the pixel coordinates file (CSV)
            </div>
            <div class="step">
                <strong>Step 3:</strong> Choose whether to create a REF3D template or use an existing file
            </div>
            <div class="step">
                <strong>Step 4:</strong> If creating template, edit with real 3D coordinates and run again
            </div>
            
            <h4>File Formats:</h4>
            <div class="file-format">
                <strong>Pixel File:</strong><br>
                frame,p1_x,p1_y,p2_x,p2_y,...,pN_x,pN_y
            </div>
            <div class="file-format">
                <strong>REF3D File:</strong><br>
                frame,p1_x,p1_y,p1_z,p2_x,p2_y,p2_z,...,pN_x,pN_y,pN_z
            </div>
            <div class="file-format">
                <strong>DLT3D Output File:</strong><br>
                frame,L1,L2,L3,L4,L5,L6,L7,L8,L9,L10,L11
            </div>
            
            <div class="warning">
                <strong>Important:</strong> The REF3D file must contain real 3D coordinates (x, y, z) for each calibration point.
            </div>
        </div>

        <div class="module-section">
            <h3>2. rec3d_one_dlt3d.py - 3D Reconstruction (Single Line)</h3>
            <p><strong>Function:</strong> 3D reconstruction using one set of DLT3D parameters per camera (single line processing).</p>
            
            <h4>Features:</h4>
            <ul>
                <li>Uses one set of DLT3D parameters per camera</li>
                <li>Processes multiple cameras simultaneously</li>
                <li>Generates CSV, 3D, and C3D files</li>
                <li>Optimized for large datasets</li>
            </ul>
            
            <h4>How to use:</h4>
            <div class="step">
                <strong>Step 1:</strong> Select DLT3D files (one per camera)
            </div>
            <div class="step">
                <strong>Step 2:</strong> Select pixel coordinate files (one per camera)
            </div>
            <div class="step">
                <strong>Step 3:</strong> Choose output directory
            </div>
            <div class="step">
                <strong>Step 4:</strong> Set data frequency (Hz)
            </div>
            
            <div class="info">
                <strong>Output:</strong> CSV, 3D, C3D (meters) and C3D (millimeters) files
            </div>
        </div>

        <div class="module-section">
            <h3>3. rec3d.py - 3D Reconstruction (Batch Processing)</h3>
            <p><strong>Function:</strong> Batch 3D reconstruction using multiple DLT3D parameter sets per camera.</p>
            
            <h4>Features:</h4>
            <ul>
                <li>Processes multiple CSV files in a directory</li>
                <li>Supports DLT3D parameters that vary per frame</li>
                <li>Multiple cameras with different parameters per frame</li>
                <li>Optimized for batch processing</li>
            </ul>
            
            <h4>How to use:</h4>
            <div class="step">
                <strong>Step 1:</strong> Select DLT3D files (one per camera)
            </div>
            <div class="step">
                <strong>Step 2:</strong> Select directory with CSV files to process
            </div>
            <div class="step">
                <strong>Step 3:</strong> Choose output directory
            </div>
            <div class="step">
                <strong>Step 4:</strong> Set data frequency (Hz)
            </div>
            
            <div class="info">
                <strong>Output:</strong> .3d files with reconstructed 3D coordinates
            </div>
        </div>

        <h2>Differences Between Modules</h2>
        
        <div class="code-block">
rec3d_one_dlt3d.py:
- One set of DLT3D parameters per camera
- Processes individual files
- Generates multiple output formats (CSV, 3D, C3D)

rec3d.py:
- Multiple DLT3D parameter sets per camera
- Batch processing of multiple files
- Parameters can vary per frame
- Output in .3d format
        </div>

        <h2>Recommended Workflow</h2>
        
        <div class="step">
            <strong>1. Calibration:</strong> Use dlt3d.py to calculate DLT3D parameters
        </div>
        <div class="step">
            <strong>2. Individual Reconstruction:</strong> Use rec3d_one_dlt3d.py for single files
        </div>
        <div class="step">
            <strong>3. Batch Reconstruction:</strong> Use rec3d.py for multiple files
        </div>

        <h2>Supported File Formats</h2>
        
        <h3>Input:</h3>
        <ul>
            <li><strong>CSV:</strong> Pixel coordinates (frame, p1_x, p1_y, p2_x, p2_y, ...)</li>
            <li><strong>DLT3D:</strong> DLT3D parameters (frame, L1, L2, ..., L11)</li>
            <li><strong>REF3D:</strong> 3D reference coordinates (frame, p1_x, p1_y, p1_z, ...)</li>
        </ul>
        
        <h3>Output:</h3>
        <ul>
            <li><strong>CSV:</strong> Reconstructed 3D coordinates</li>
            <li><strong>3D:</strong> vailá-specific format</li>
            <li><strong>C3D:</strong> Industry standard format (meters and millimeters)</li>
        </ul>

        <h2>Technical Details</h2>
        
        <h3>DLT3D Parameters:</h3>
        <p>The DLT3D method uses 11 parameters (L1-L11) to transform pixel coordinates (u,v) to 3D world coordinates (X,Y,Z):</p>
        <div class="code-block">
u = (L1*X + L2*Y + L3*Z + L4) / (L9*X + L10*Y + L11*Z + 1)
v = (L5*X + L6*Y + L7*Z + L8) / (L9*X + L10*Y + L11*Z + 1)
        </div>
        
        <h3>3D Reconstruction:</h3>
        <p>For multiple cameras, the system solves the overdetermined linear system using least squares to find the best 3D point that minimizes the reprojection errorrrr across all cameras.</p>

        <div class="warning">
            <strong>Important Tips:</strong>
            <ul>
                <li>Ensure pixel files have vailá's standard header</li>
                <li>Verify that 3D reference coordinates are correct</li>
                <li>Use the same data frequency throughout the process</li>
                <li>Keep backups of original files</li>
                <li>Check camera synchronization for multi-camera setups</li>
            </ul>
        </div>

        <h2>Error Handling</h2>
        <ul>
            <li><strong>Missing frames:</strong> Frames not present in all cameras are skipped</li>
            <li><strong>Invalid coordinates:</strong> NaN values are used for missing or invalid data</li>
            <li><strong>Calibration errorrrrs:</strong> Check DLT3D parameter quality before reconstruction</li>
        </ul>

        <h2>Performance Optimization</h2>
        <ul>
            <li>Pre-allocated NumPy arrays for faster processing</li>
            <li>Vectorized operations for better performance</li>
            <li>Progress tracking for large datasets</li>
            <li>Memory-efficient processing</li>
        </ul>

        <h2>Support</h2>
        <p>For questions or issues, consult the complete vailá documentation or contact the development team.</p>
        
        <div class="info">
            <strong>vailá - Multimodal Toolbox</strong><br>
            © Paulo Santiago, Guilherme Cesar, Ligia Mochida, Bruno Bedo<br>
            <a href="https://github.com/vaila-multimodaltoolbox/vaila" target="_blank">https://github.com/vaila-multimodaltoolbox/vaila</a>
        </div>
    </div>
</body>
</html> 